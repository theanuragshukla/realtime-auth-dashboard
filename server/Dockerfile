FROM alpine

RUN apk add nodejs npm 

ARG PORT
ARG JWT_SECRET
ARG PG_URI
ARG MAILER_USERNAME
ARG MAILER_PASSWORD
ARG REDIS_URI
ARG CLIENT_URL

ENV PORT $PORT
ENV CLIENT_URL $CLIENT_URL
ENV JWT_SECRET $JWT_SECRET
ENV PG_URI $PG_URI
ENV REDIS_URI $REDIS_URI
ENV MAILER_USERNAME $MAILER_USERNAME
ENV MAILER_PASSWORD $MAILER_PASSWORD

WORKDIR /app

COPY package*.json .
RUN npm i -g typescript
RUN npm ci

COPY . .

EXPOSE 8000

CMD [ "npm" , "start" ]

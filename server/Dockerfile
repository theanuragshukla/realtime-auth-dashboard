FROM alpine

RUN apk add nodejs npm 

ARG PORT
ARG JWT_SECRET
ARG POSTGRES_URI
ARG MAILER_USERNAME
ARG MAILER_PASSWORD

ENV PORT $PORT
ENV JWT_SECRET $JWT_SECRET
ENV POSTGRES_URI $POSTGRES_URI
ENV MAILER_USERNAME $MAILER_USERNAME
ENV MAILER_PASSWORD $MAILER_PASSWORD

WORKDIR /app

COPY package*.json .
RUN npm ci

COPY . .

EXPOSE 8000

CMD [ "npm" , "start" ]
